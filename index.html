<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡åŒ–ç¥­ãƒ¬ã‚¸ãƒ»è§£æã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ğŸˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; line-height: 1.4; color: #333; max-width: 1200px; margin: 0 auto; padding: 5px; background-color: #f8f9fa; }
        
        .sticky-header { 
            background: #fff; padding: 10px; border-radius: 12px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 10px;
            position: sticky; top: 0; z-index: 100;
        }
        
        .flex-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        
        .customer-counter {
            background-color: #32CD32; 
            color: white; padding: 10px 20px; border-radius: 8px;
            font-weight: bold; text-align: center; min-width: 140px;
        }
        .customer-counter b { font-size: 1.4em; }

        .register-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; flex-grow: 1; }
        .cash-unit { border: 1px solid #ddd; border-radius: 6px; padding: 5px; text-align: center; background: #fff; }
        .cash-unit span { display: block; font-size: 0.7em; color: #666; }
        .cash-unit b { font-size: 1.1em; }
        .min-badge { display: none; font-size: 0.75em; color: #e74c3c; margin-top: 2px; border-top: 1px dashed #ddd; padding-top: 2px; font-weight: bold; }
        .danger { background-color: #fff5f5; border-color: #ffc9c9; color: #e03131; }

        .flex-container { display: flex; gap: 10px; flex-wrap: wrap; }
        .card { background: white; padding: 12px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); flex: 1; min-width: 380px; }
        
        h2 { font-size: 1.05em; border-left: 4px solid #2980b9; padding-left: 8px; margin: 0 0 10px 0; }
        
        .mini-table { width: 100%; border-collapse: collapse; font-size: 0.8em; text-align: center; }
        .mini-table th, .mini-table td { border: 1px solid #eee; padding: 4px; }
        .highlight-row { background-color: #fff9db; font-weight: bold; outline: 2px solid #e67e22; }
        
        .chart-wrapper { height: 280px; margin-top: 5px; }

        .input-row { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; align-items: center; margin-bottom: 8px; font-size: 0.8em; }
        input[type="number"] { width: 45px; padding: 2px; text-align: center; border: 1px solid #ccc; border-radius: 4px; }
        
        .btn-area { text-align: center; display: flex; justify-content: center; gap: 5px; }
        button { padding: 6px 12px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; font-size: 0.85em; transition: 0.2s; }
        .btn-main { background: #2980b9; color: white; }
        .btn-ans { background: #34495e; color: white; }
        .btn-min { background: #e67e22; color: white; }
        .btn-reset { background: #adb5bd; color: white; }
        button:hover { opacity: 0.8; }

        .status-box { margin-top: 5px; padding: 8px; background: #fff9db; border-radius: 5px; font-size: 0.85em; border: 1px solid #e67e22; }
        
        /* èª¬æ˜æ–‡ã‚¨ãƒªã‚¢ */
        .info-card { background: #fdfaf0 !important; border: 1px solid #f39c12 !important; }
        .info-card ul { margin: 5px 0; padding-left: 20px; font-size: 0.9em; }
        .info-card p { margin: 5px 0; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="sticky-header">
    <div class="input-row">
        åˆæœŸæšæ•°ï¼š
        10å††:<input type="number" id="init10" value="0"> 
        50å††:<input type="number" id="init50" value="0"> 
        100å††:<input type="number" id="init100" value="0"> 
        500å††:<input type="number" id="init500" value="0"> 
        1000å††:<input type="number" id="init1000" value="0">
    </div>
    
    <div class="flex-header">
        <div class="register-grid">
            <div class="cash-unit" id="box-10"><span>10å††</span><b>0</b><div class="min-badge" id="min-10">æšæ•°ã®æœ€å°å€¤: 0</div></div>
            <div class="cash-unit" id="box-50"><span>50å††</span><b>0</b><div class="min-badge" id="min-50">æšæ•°ã®æœ€å°å€¤: 0</div></div>
            <div class="cash-unit" id="box-100"><span>100å††</span><b>0</b><div class="min-badge" id="min-100">æšæ•°ã®æœ€å°å€¤: 0</div></div>
            <div class="cash-unit" id="box-500"><span>500å††</span><b>0</b><div class="min-badge" id="min-500">æšæ•°ã®æœ€å°å€¤: 0</div></div>
            <div class="cash-unit" id="box-1000"><span>1000å††</span><b>0</b><div class="min-badge" id="min-1000">æšæ•°ã®æœ€å°å€¤: 0</div></div>
        </div>

        <div class="customer-counter">
            <span style="font-size: 0.8em; display: block;">ç´¯è¨ˆæ¥å®¢äººæ•°</span>
            <b id="customerTotal">0</b> äºº
        </div>
    </div>

    <div class="btn-area">
        <button class="btn-main" onclick="stepSim()">å®¢10äººè¿½åŠ </button>
        <button class="btn-min" onclick="toggleMin()">æšæ•°ã®æœ€å°å€¤ è¡¨ç¤ºåˆ‡æ›¿</button>
        <button class="btn-ans" onclick="toggleLegend()">å‡¡ä¾‹è¡¨ç¤ºåˆ‡æ›¿</button>
        <button class="btn-reset" onclick="resetSim()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
</div>

<div class="flex-container">
    <div class="card">
        <h2>ä¹±æ•°ã¨æ”¯æ‰•ã„ï¼ˆå®šä¾¡240å††ï¼‰</h2>
        <table class="mini-table">
            <thead>
                <tr><th>æ”¯æ‰•ã„æ–¹æ³•</th><th>ãŠé‡£ã‚Š</th><th>ä¹±æ•°ç¯„å›²</th></tr>
            </thead>
            <tbody>
                <tr id="row-0"><td>100å††x2 + 10å††x4</td><td>ãªã—</td><td>0.00â‰¦xï¼œ0.17</td></tr>
                <tr id="row-1"><td>100å††x1 + 50å††x2 + 10å††x4</td><td>ãªã—</td><td>0.17â‰¦xï¼œ0.33</td></tr>
                <tr id="row-2"><td>250å††(100x2+50x1)</td><td>10å††x1</td><td>0.33â‰¦xï¼œ0.50</td></tr>
                <tr id="row-3"><td>300å††(100å††x3)</td><td>50å††+10å††x1</td><td>0.50â‰¦xï¼œ0.67</td></tr>
                <tr id="row-4"><td>500å††ç‰</td><td>100x2,50x1,10x1</td><td>0.67â‰¦xï¼œ0.83</td></tr>
                <tr id="row-5"><td>1000å††æœ­</td><td>500+1,100x2..</td><td>0.83â‰¦xï¼œ1.00</td></tr>
            </tbody>
        </table>
        
        <div class="status-box">
            ç™ºç”Ÿä¹±æ•°ğŸ²: <span id="lastRand" style="font-weight:bold; color:#d35400;">-</span><br>
            é¸æŠã•ã‚ŒãŸæ”¯æ‰•ã„: <b><span id="lastAction">-</span></b>
        </div>

        <div class="card info-card" style="margin-top:10px;">
            <p><strong>ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç›®çš„ã€‘</strong></p>
            <ul>
                <li><strong>ç­‰ç¢ºç‡ã®åŸå‰‡:</strong> ä¹±æ•°(0~1)ã‚’6ç­‰åˆ†ã—ã€å„æ”¯æ‰•ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‡ç­‰ã«ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚</li>
                <li><strong>åœ¨åº«ã®ãƒ‡ãƒƒãƒ‰ãƒ’ãƒ¼ãƒˆ:</strong> 10å††ç‰ãŒå¢—ãˆã‚‹å®¢(33%)ã¨ã€10å††ç‰ãŒæ¸›ã‚‹å®¢(67%)ã®ãƒãƒ©ãƒ³ã‚¹ã«ã‚ˆã‚‹æŠœãã¤æŠœã‹ã‚Œã¤ã®æ¨ç§»ã‚’è¦³å¯Ÿã—ã¾ã™ã€‚</li>
                <li><strong>ãƒªã‚¹ã‚¯ç®¡ç†:</strong> ã€Œæšæ•°ã®æœ€å°å€¤ã€ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€ãŠé‡£ã‚Šä¸è¶³ã‚’é˜²ããŸã‚ã®å¿…è¦æœ€ä½é™ã®æº–å‚™æšæ•°ã‚’å‰²ã‚Šå‡ºã›ã¾ã™ã€‚</li>
            </ul>
        </div>
    </div>

    <div class="card">
        <h2>æšæ•°æ¨ç§»ï¼ˆãƒ‡ãƒƒãƒ‰ãƒ’ãƒ¼ãƒˆï¼‰</h2>
        <div class="chart-wrapper"><canvas id="miniChart"></canvas></div>
        <div class="card info-card" style="margin-top:10px;">
            <p><strong>ã€ä½¿ã„æ–¹ã®ãƒ’ãƒ³ãƒˆã€‘</strong></p>
            <p>1. åˆæœŸæšæ•°ã‚’å…¨ã¦0ã«ã—ã¦ã€Œ10äººè¿½åŠ ã€ã‚’é€£æ‰“ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br>
            2. ã©ã®ç¡¬è²¨ãŒä¸€ç•ªæ—©ããƒã‚¤ãƒŠã‚¹ï¼ˆèµ¤è‰²ï¼‰ã«ãªã‚‹ã‹è¦³å¯Ÿã—ã¾ã™ã€‚<br>
            3. ã€Œæšæ•°ã®æœ€å°å€¤ã€ã‚’è¡¨ç¤ºã—ã€ãã®çµ¶å¯¾å€¤åˆ†ã ã‘åˆæœŸæšæ•°ã‚’å…¥åŠ›ã—ã¦å†æŒ‘æˆ¦ï¼</p>
        </div>
    </div>
</div>

<script>
let wallet = { n10: 0, n50: 0, n100: 0, n500: 0, n1000: 0 };
let minWallet = { n10: 0, n50: 0, n100: 0, n500: 0, n1000: 0 };
let historyData = { labels: [0], n10: [0], n50: [0], n100: [0], n500: [0], n1000: [0] };
let showMin = false;
let showLegend = false;
let customerCount = 0;

const ctx = document.getElementById('miniChart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: historyData.labels,
        datasets: [
            { label: '10å††', data: historyData.n10, borderColor: '#e67e22', borderWidth: 2.5, pointRadius: 0, tension: 0.1 },
            { label: '50å††', data: historyData.n50, borderColor: '#9b59b6', borderWidth: 2.5, pointRadius: 0, tension: 0.1 },
            { label: '100å††', data: historyData.n100, borderColor: '#3498db', borderWidth: 2.5, pointRadius: 0, tension: 0.1 },
            { label: '500å††', data: historyData.n500, borderColor: '#f1c40f', borderWidth: 2.5, pointRadius: 0, tension: 0.1 },
            { label: '1000å††', data: historyData.n1000, borderColor: '#2ecc71', borderWidth: 2.5, pointRadius: 0, tension: 0.1 }
        ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
});

function stepSim() {
    if(customerCount === 0) {
        wallet.n10 = parseInt(document.getElementById('init10').value) || 0;
        wallet.n50 = parseInt(document.getElementById('init50').value) || 0;
        wallet.n100 = parseInt(document.getElementById('init100').value) || 0;
        wallet.n500 = parseInt(document.getElementById('init500').value) || 0;
        wallet.n1000 = parseInt(document.getElementById('init1000').value) || 0;
        Object.keys(wallet).forEach(k => { historyData[k][0] = wallet[k]; minWallet[k] = wallet[k]; });
    }

    for (let i = 0; i < 10; i++) {
        customerCount++;
        const rand = Math.random();
        let sIdx = 0;
        for(let j=0; j<6; j++) document.getElementById(`row-${j}`).className = "";

        if (rand < 0.166) { sIdx = 0; wallet.n100 += 2; wallet.n10 += 4; }
        else if (rand < 0.333) { sIdx = 1; wallet.n100 += 1; wallet.n50 += 2; wallet.n10 += 4; }
        else if (rand < 0.500) { sIdx = 2; wallet.n100 += 2; wallet.n50 += 1; wallet.n10 -= 1; }
        else if (rand < 0.666) { sIdx = 3; wallet.n100 += 3; wallet.n50 -= 1; wallet.n10 -= 1; }
        else if (rand < 0.833) { sIdx = 4; wallet.n500 += 1; wallet.n100 -= 2; wallet.n50 -= 1; wallet.n10 -= 1; }
        else { sIdx = 5; wallet.n1000 += 1; wallet.n500 -= 1; wallet.n100 -= 2; wallet.n50 -= 1; wallet.n10 -= 1; }

        Object.keys(wallet).forEach(k => { if(wallet[k] < minWallet[k]) minWallet[k] = wallet[k]; });

        document.getElementById(`row-${sIdx}`).className = "highlight-row";
        document.getElementById('lastRand').textContent = rand.toFixed(4);
        document.getElementById('lastAction').textContent = document.getElementById(`row-${sIdx}`).cells[0].textContent;
        historyData.labels.push(customerCount);
        Object.keys(wallet).forEach(k => historyData[k].push(wallet[k]));
    }
    updateUI();
}

function toggleMin() {
    showMin = !showMin;
    document.querySelectorAll('.min-badge').forEach(el => el.style.display = showMin ? 'block' : 'none');
}

function toggleLegend() {
    showLegend = !showLegend;
    chart.options.plugins.legend.display = showLegend;
    chart.update();
}

function updateUI() {
    document.getElementById('customerTotal').textContent = customerCount;
    const keyMap = { n10: '10', n50: '50', n100: '100', n500: '500', n1000: '1000' };
    Object.keys(wallet).forEach(k => {
        const id = keyMap[k];
        document.querySelector(`#box-${id} b`).textContent = wallet[k];
        document.getElementById(`box-${id}`).classList.toggle('danger', wallet[k] < 0);
        document.getElementById(`min-${id}`).textContent = `æšæ•°ã®æœ€å°å€¤: ${minWallet[k]}`;
    });
    chart.update();
}

function resetSim() {
    wallet = { n10: 0, n50: 0, n100: 0, n500: 0, n1000: 0 };
    minWallet = { n10: 0, n50: 0, n100: 0, n500: 0, n1000: 0 };
    customerCount = 0;
    historyData = { labels: [0], n10: [0], n50: [0], n100: [0], n500: [0], n1000: [0] };
    chart.data.labels = historyData.labels;
    chart.data.datasets.forEach((ds, i) => ds.data = historyData[Object.keys(wallet)[i]]);
    updateUI();
}
</script>
</body>
</html>
