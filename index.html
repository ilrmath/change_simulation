<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¯æ‰•ã„ç¡¬è²¨ãƒ»ç´™å¹£æšæ•°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; line-height: 1.3; color: #333; max-width: 1200px; margin: 0 auto; padding: 5px; background-color: #f8f9fa; }
        
        /* ã‚¿ã‚¤ãƒˆãƒ«ã‚¨ãƒªã‚¢ã®ã‚¹ãƒªãƒ åŒ– */
        .title-bar { background: #2980b9; color: white; padding: 5px 15px; border-radius: 8px; margin-bottom: 8px; font-size: 1.1em; font-weight: bold; text-align: center; }

        .sticky-header { 
            background: #fff; padding: 8px; border-radius: 12px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 8px;
            position: sticky; top: 0; z-index: 100;
        }
        
        .flex-header { display: flex; align-items: stretch; gap: 8px; margin-bottom: 5px; flex-wrap: wrap; }
        
        .customer-counter {
            background-color: #32CD32; 
            color: white; padding: 4px 12px; border-radius: 8px;
            font-weight: bold; text-align: center; flex: 0 1 120px;
            display: flex; flex-direction: column; justify-content: center;
            white-space: nowrap;
        }
        .customer-counter b { font-size: 1.2em; }

        .register-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; flex: 1 1 300px; }
        .cash-unit { border: 1px solid #ddd; border-radius: 6px; padding: 3px; text-align: center; background: #fff; }
        .cash-unit span { display: block; font-size: 0.7em; color: #666; }
        .cash-unit b { font-size: 1.05em; }
        
        .min-badge { display: none; font-size: 0.65em; color: #e74c3c; border-top: 1px dashed #ddd; padding-top: 1px; font-weight: bold; margin-top: 1px; }
        .danger { background-color: #fff5f5; border-color: #ffc9c9; color: #e03131; }

        .flex-container { display: flex; gap: 8px; flex-wrap: wrap; }
        .card { background: white; padding: 10px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); flex: 1 1 450px; min-width: 0; }
        
        h2 { font-size: 0.95em; border-left: 4px solid #2980b9; padding-left: 8px; margin: 0 0 8px 0; }
        
        .mini-table-wrapper { width: 100%; overflow-x: auto; }
        .mini-table { width: 100%; border-collapse: collapse; font-size: 0.8em; text-align: center; table-layout: auto; }
        .mini-table th, .mini-table td { border: 1px solid #eee; padding: 4px 2px; word-break: keep-all; white-space: nowrap; }
        .highlight-row { background-color: #fff9db; font-weight: bold; outline: 2px solid #e67e22; }
        
        .chart-wrapper { height: 260px; margin-top: 2px; width: 100%; }

        .input-row { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; align-items: center; margin-bottom: 5px; font-size: 0.75em; }
        input[type="number"] { width: 40px; padding: 1px; text-align: center; border: 1px solid #ccc; border-radius: 4px; }
        
        .btn-area { text-align: center; display: flex; justify-content: center; gap: 4px; flex-wrap: wrap; }
        button { padding: 4px 10px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; font-size: 0.8em; transition: 0.2s; }
        .btn-main { background: #2980b9; color: white; }
        .btn-ans { background: #34495e; color: white; }
        .btn-min { background: #e67e22; color: white; }
        .btn-reset { background: #adb5bd; color: white; }

        .status-box { margin-top: 5px; padding: 6px; background: #fff9db; border-radius: 5px; font-size: 0.85em; border: 1px solid #e67e22; }
        
        .info-card { background: #fdfaf0 !important; border: 1px solid #f39c12 !important; margin-top: 5px; }
        .info-card ul { margin: 2px 0; padding-left: 18px; font-size: 0.85em; }
        .info-card p { margin: 2px 0; font-size: 0.85em; font-weight: bold; }
    </style>
</head>
<body>

<div class="title-bar">
    æ”¯æ‰•ã„ç¡¬è²¨ãƒ»ç´™å¹£æšæ•°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³(ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­æ³•)
</div>

<div class="sticky-header">
    <div class="input-row">
        åˆæœŸæšæ•°ï¼š
        10å††:<input type="number" id="init10" value="0"> 
        50å††:<input type="number" id="init50" value="0"> 
        100å††:<input type="number" id="init100" value="0"> 
        500å††:<input type="number" id="init500" value="0"> 
        1000å††:<input type="number" id="init1000" value="0">
    </div>
    
    <div class="flex-header">
        <div class="register-grid">
            <div class="cash-unit" id="box-10"><span>10å††</span><b>0</b><div class="min-badge" id="min-10">æœ€å°å€¤: 0</div></div>
            <div class="cash-unit" id="box-50"><span>50å††</span><b>0</b><div class="min-badge" id="min-50">æœ€å°å€¤: 0</div></div>
            <div class="cash-unit" id="box-100"><span>100å††</span><b>0</b><div class="min-badge" id="min-100">æœ€å°å€¤: 0</div></div>
            <div class="cash-unit" id="box-500"><span>500å††</span><b>0</b><div class="min-badge" id="min-500">æœ€å°å€¤: 0</div></div>
            <div class="cash-unit" id="box-1000"><span>1000å††</span><b>0</b><div class="min-badge" id="min-1000">æœ€å°å€¤: 0</div></div>
        </div>

        <div class="customer-counter">
            <span style="font-size: 0.7em;">ç´¯è¨ˆæ¥å®¢äººæ•°</span>
            <b><span id="customerTotal">0</span> äºº</b>
        </div>
    </div>

    <div class="btn-area">
        <button class="btn-main" onclick="stepSim()">å®¢10äººè¿½åŠ </button>
        <button class="btn-min" onclick="toggleMin()">æœ€å°å€¤ è¡¨ç¤ºåˆ‡æ›¿</button>
        <button class="btn-ans" onclick="toggleLegend()">å‡¡ä¾‹è¡¨ç¤º åˆ‡æ›¿</button>
        <button class="btn-reset" onclick="resetSim()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
</div>

<div class="flex-container">
    <div class="card">
        <h2>ä¹±æ•°ã¨æ”¯æ‰•ã„ï¼ˆå®¢ã¯å®šä¾¡240å††ã®ã¬ã„ãã‚‹ã¿ğŸˆã‚’1ã¤è²·ã„ã¾ã™ï¼‰</h2>
        <div class="mini-table-wrapper">
            <table class="mini-table">
                <thead>
                    <tr><th>æ”¯æ‰•ã„</th><th>ãŠé‡£ã‚Šã®å†…å®¹</th><th>ä¹±æ•°ç¯„å›²</th></tr>
                </thead>
                <tbody>
                    <tr id="row-0"><td>100x2 + 10x4æš</td><td>ãªã—</td><td>0.00â‰¦xï¼œ0.20</td></tr>
                    <tr id="row-1"><td>100x1+50x2+10x4</td><td>ãªã—</td><td>0.20â‰¦xï¼œ0.40</td></tr>
                    <tr id="row-2"><td>300å††(100x3)</td><td>50å††+10x1</td><td>0.40â‰¦xï¼œ0.60</td></tr>
                    <tr id="row-3"><td>500å††ç‰</td><td>100x2, 50x1, 10x1</td><td>0.60â‰¦xï¼œ0.80</td></tr>
                    <tr id="row-4"><td>1000å††æœ­</td><td>500x1, 100x2, 50x1, 10x1</td><td>0.80â‰¦xï¼œ1.00</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="status-box">
            ç™ºç”Ÿä¹±æ•°ğŸ²: <span id="lastRand" style="font-weight:bold; color:#d35400;">-</span>&nbsp;&nbsp;
            é¸æŠæ”¯æ‰•ã„: <b><span id="lastAction">-</span></b>
        </div>

        <div class="card info-card">
            <p>ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç›®çš„ã€‘</p>
            <ul>
                <li><strong>ç­‰ç¢ºç‡:</strong> ä¹±æ•°ã‚’5ç­‰åˆ†ã—å…¬å¹³ã«æ¤œè¨¼ã—ã¾ã™ã€‚</li>
                <li><strong>å¤‰å‹•:</strong> 10å††ç‰ã®å¢—æ¸›ã«ã‚ˆã‚‹ãƒ‡ãƒƒãƒ‰ãƒ’ãƒ¼ãƒˆã‚’è¦³å¯Ÿã€‚</li>
                <li><strong>ç®¡ç†:</strong> æœ€å°å€¤ã‹ã‚‰å¿…è¦ãªæº–å‚™æšæ•°ã‚’ç®—å‡ºã—ã¾ã™ã€‚</li>
            </ul>
        </div>
    </div>

    <div class="card">
        <h2>åœ¨åº«æšæ•°ã®æ¨ç§»ã‚°ãƒ©ãƒ•</h2>
        <div class="chart-wrapper"><canvas id="miniChart"></canvas></div>
        <div class="card info-card">
            <p>ã€ä½¿ã„æ–¹ã®ãƒ’ãƒ³ãƒˆã€‘</p>
            <ul>
                <li>æšæ•°0ã§é–‹å§‹ã—ã€ã©ã®é‡‘ç¨®ãŒå…ˆã«ä¸è¶³ã™ã‚‹ã‹è¦‹ã¾ã™ã€‚</li>
                <li>æœ€å°å€¤ã®çµ¶å¯¾å€¤ã‚’åˆæœŸæšæ•°ã«å…¥ã‚Œå†æ¤œè¨¼ï¼</li>
            </ul>
        </div>
    </div>
</div>

<script>
let wallet = { n10: 0, n50: 0, n100: 0, n500: 0, n1000: 0 };
let minWallet = { n10: 0, n50: 0, n100: 0, n500: 0, n1000: 0 };
let historyData = { labels: [0], n10: [0], n50: [0], n100: [0], n500: [0], n1000: [0] };
let showMin = false;
let showLegend = false;
let customerCount = 0;

const ctx = document.getElementById('miniChart').getContext('2d');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: historyData.labels,
        datasets: [
            { label: '10å††', data: historyData.n10, borderColor: '#e67e22', borderWidth: 2.2, pointRadius: 0, tension: 0.1 },
            { label: '50å††', data: historyData.n50, borderColor: '#9b59b6', borderWidth: 2.2, pointRadius: 0, tension: 0.1 },
            { label: '100å††', data: historyData.n100, borderColor: '#3498db', borderWidth: 2.2, pointRadius: 0, tension: 0.1 },
            { label: '500å††', data: historyData.n500, borderColor: '#f1c40f', borderWidth: 2.2, pointRadius: 0, tension: 0.1 },
            { label: '1000å††', data: historyData.n1000, borderColor: '#2ecc71', borderWidth: 2.2, pointRadius: 0, tension: 0.1 }
        ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { ticks: { font: { size: 10 } } }, x: { ticks: { font: { size: 10 } } } } }
});

function stepSim() {
    if(customerCount === 0) {
        wallet.n10 = parseInt(document.getElementById('init10').value) || 0;
        wallet.n50 = parseInt(document.getElementById('init50').value) || 0;
        wallet.n100 = parseInt(document.getElementById('init100').value) || 0;
        wallet.n500 = parseInt(document.getElementById('init500').value) || 0;
        wallet.n1000 = parseInt(document.getElementById('init1000').value) || 0;
        Object.keys(wallet).forEach(k => { historyData[k][0] = wallet[k]; minWallet[k] = wallet[k]; });
    }

    for (let i = 0; i < 10; i++) {
        customerCount++;
        const rand = Math.random();
        let sIdx = 0;
        for(let j=0; j<5; j++) document.getElementById(`row-${j}`).className = "";

        if (rand < 0.20) { sIdx = 0; wallet.n100 += 2; wallet.n10 += 4; }
        else if (rand < 0.40) { sIdx = 1; wallet.n100 += 1; wallet.n50 += 2; wallet.n10 += 4; }
        else if (rand < 0.60) { sIdx = 2; wallet.n100 += 3; wallet.n50 -= 1; wallet.n10 -= 1; }
        else if (rand < 0.80) { sIdx = 3; wallet.n500 += 1; wallet.n100 -= 2; wallet.n50 -= 1; wallet.n10 -= 1; }
        else { sIdx = 4; wallet.n1000 += 1; wallet.n500 -= 1; wallet.n100 -= 2; wallet.n50 -= 1; wallet.n10 -= 1; }

        Object.keys(wallet).forEach(k => { if(wallet[k] < minWallet[k]) minWallet[k] = wallet[k]; });

        document.getElementById(`row-${sIdx}`).className = "highlight-row";
        document.getElementById('lastRand').textContent = rand.toFixed(4);
        document.getElementById('lastAction').textContent = document.getElementById(`row-${sIdx}`).cells[0].textContent;
        historyData.labels.push(customerCount);
        Object.keys(wallet).forEach(k => historyData[k].push(wallet[k]));
    }
    updateUI();
}

function toggleMin() {
    showMin = !showMin;
    document.querySelectorAll('.min-badge').forEach(el => el.style.display = showMin ? 'block' : 'none');
}

function toggleLegend() {
    showLegend = !showLegend;
    chart.options.plugins.legend.display = showLegend;
    chart.update();
}

function updateUI() {
    document.getElementById('customerTotal').textContent = customerCount;
    const keyMap = { n10: '10', n50: '50', n100: '100', n500: '500', n1000: '1000' };
    Object.keys(wallet).forEach(k => {
        const id = keyMap[k];
        document.querySelector(`#box-${id} b`).textContent = wallet[k];
        document.getElementById(`box-${id}`).classList.toggle('danger', wallet[k] < 0);
        document.getElementById(`min-${id}`).textContent = `æœ€å°å€¤: ${minWallet[k]}`;
    });
    chart.update();
}

function resetSim() {
    wallet = { n10: 0, n50: 0, n100: 0, n500: 0, n1000: 0 };
    minWallet = { n10: 0, n50: 0, n100: 0, n500: 0, n1000: 0 };
    customerCount = 0;
    historyData = { labels: [0], n10: [0], n50: [0], n100: [0], n500: [0], n1000: [0] };
    chart.data.labels = historyData.labels;
    chart.data.datasets.forEach((ds, i) => ds.data = historyData[Object.keys(wallet)[i]]);
    updateUI();
}
</script>
</body>
</html>
